ğŸ§­ Full Plan: Step-by-Step Guide



â¸»



ğŸ—‚ï¸ 1. Backup Linux Home and Packages



Backup your /home/ directory:



rsync -aAXv /home/yourusername /run/media/yourusername/BackupDrive/home-backup



Or, if youâ€™re on Arch/CachyO



tar -czvf home-backup.tar.gz /home/yourusername



âœ… Tip: Keep hidden files (.bashrc, .config, etc.) â€” they hold all your dotfiles.



Save your installed package list:



For Arch-based systems:



pacman -Qqe > pkglist.txt



For AUR packages too (optional):



pacman -Qqm > aur-pkglist.txt



ğŸ’½ 2. Reinstall Windows on the Main Drive

	â€¢	Use the Windows installer USB.

	â€¢	During install, select the main drive and click:

	â€¢	â€œDeleteâ€ on existing partitions

	â€¢	Select unallocated space â†’ â€œNextâ€ â†’ let it auto-partition

	â€¢	Complete Windows install.



ğŸ’¡ Now Windows will occupy the main drive cleanly, no Linux partitions.



â¸»



ğŸ§ 3. Reinstall Linux on the Second Drive

	â€¢	Boot into your Linux installer (e.g., CachyOS, Arch, Fedora, etc.).

	â€¢	Choose Manual partitioning:

	â€¢	Install / (root) on your second drive

	â€¢	Create separate /home if you want

	â€¢	Set bootloader to second drive or let it install to main drive (will overwrite Windows bootloader unless youâ€™re careful)

	â€¢	Finish Linux install.



â¸»



ğŸ” 4. Restore Your Linux Setup



Restore /home:



rsync -aAXv /run/media/yourusername/BackupDrive/home-backup /home/yourusername



Or if tarâ€™d:



tar -xzvf home-backup.tar.gz -C /



ğŸ” Make sure to match your old username and UID, or fix ownership:



sudo chown -R yourusername:yourusername /home/yourusername



Restore packages:



sudo pacman -S --needed - < pkglist.txt

yay -S --needed - < aur-pkglist.txt  # If you use yay



âš™ï¸ 5. Fix Boot (if needed)



If GRUB didnâ€™t install properly during your Linux reinstall, or Windows overwrote it:

	â€¢	Boot into Linux live USB

	â€¢	Mount Linux system (/mnt)

	â€¢	Chroot in

	â€¢	Reinstall GRUB:



sudo mount /dev/sdXn /mnt          # Linux root

sudo mount --bind /dev /mnt/dev

sudo mount --bind /proc /mnt/proc

sudo mount --bind /sys /mnt/sys

sudo chroot /mnt

grub-install /dev/sdX              # Usually main disk (not a partition)

update-grub

exit

reboot



Now GRUB should show both Windows and Linux.



ğŸ§  Final Notes

Topic

Note

Home backup

Make sure you include hidden folders (.config, .local, etc.)

Package restore

Some apps may have changed names or AUR packages may be missing â€” just skip those

Drive layout

Windows on main drive, Linux on second drive is clean and very stable

BIOS/UEFI

Make sure both OSes install in same mode (UEFI or BIOS)



Great! Hereâ€™s your full copy-paste-ready guide, including:

	â€¢	âœ… Backup script (home + packages)

	â€¢	ğŸ’¾ Reinstall instructions for Windows + Linux

	â€¢	ğŸ”„ Restore script

	â€¢	âš™ï¸ Partition layout for clean setup



â¸»



âœ… Step 1: Backup Linux (backup-linux.sh)



Save this as backup-linux.sh and run it:



#!/bin/bash



# Update: change this to your actual username and backup drive mount

USER="yourusername"

BACKUP_DRIVE="/run/media/$USER/BackupDrive"



echo "ğŸ“¦ Backing up home directory to $BACKUP_DRIVE..."

rsync -aAXv /home/$USER "$BACKUP_DRIVE/home-backup"



echo "ğŸ“ Saving pacman package list..."

pacman -Qqe > "$BACKUP_DRIVE/pkglist.txt"

pacman -Qqm > "$BACKUP_DRIVE/aur-pkglist.txt"



echo "âœ… Backup complete!"



ğŸ¯ Replace yourusername and BackupDrive accordingly before running:



chmod +x backup-linux.sh

./backup-linux.sh



ğŸ’¾ Step 2: Reinstall Windows on Main Drive



Use your bootable USB:

	1.	Boot into the Windows installer

	2.	On the â€œWhere to installâ€ screen:

	â€¢	Select your main drive (e.g., Disk 0)

	â€¢	Click Delete on each partition (it will say Linux or Unknown)

	â€¢	When itâ€™s all unallocated space, click Next

	3.	Let Windows finish installation



âœ… Now Windows is installed clean on Disk 0 (or your main SSD).



â¸»



ğŸ§ Step 3: Reinstall Linux (e.g., CachyOS) on Second Drive



Partition layout suggestion:

Partition

Mount Point

Filesystem

Notes

/dev/sdb1

/

ext4 or btrfs

Root partition

/dev/sdb2

/home

ext4 or btrfs

Optional, can restore your home here

/dev/sdb3

(swap)

swap

Optional, 2â€“4 GB

/dev/sdb (disk)

GRUB install target

Set in installer



âš ï¸ Make sure you donâ€™t overwrite the Windows drive (Disk 0)



ğŸ” Step 4: Restore Linux Setup (restore-linux.sh)



Once Linux is reinstalled and booted, run this:



#!/bin/bash



# Update: change these paths to match your setup

USER="yourusername"

BACKUP_DRIVE="/run/media/$USER/BackupDrive"



echo "ğŸ“‚ Restoring /home directory..."

rsync -aAXv "$BACKUP_DRIVE/home-backup/" "/home/$USER/"



echo "ğŸ”‘ Fixing ownership..."

chown -R $USER:$USER "/home/$USER"



echo "ğŸ“¦ Reinstalling pacman packages..."

pacman -Syu --needed - < "$BACKUP_DRIVE/pkglist.txt"



if command -v yay &> /dev/null; then

    echo "ğŸ“¦ Reinstalling AUR packages..."

    yay -S --needed - < "$BACKUP_DRIVE/aur-pkglist.txt"

else

    echo "âš ï¸ AUR helper (e.g. yay) not installed. Skipping AUR packages."

fi



echo "âœ… Restore complete!"



Run it after mounting your backup drive:



chmod +x restore-linux.sh

./restore-linux.sh



âš™ï¸ Step 5: Fix GRUB (If Linux doesnâ€™t boot)



If you boot into Windows only after Linux install, do this:



Boot from a Linux live USB, then:



sudo mount /dev/sdXn /mnt               # Mount Linux root

sudo mount --bind /dev /mnt/dev

sudo mount --bind /proc /mnt/proc

sudo mount --bind /sys /mnt/sys

sudo chroot /mnt

grub-install /dev/sdX                   # X = your main drive (sda/nvme0n1)

update-grub

exit

reboot



âœ… GRUB should now detect Windows + Linux.



â¸»



ğŸ§  Optional: UEFI Tip

	â€¢	Make sure both Windows and Linux are installed in the same boot mode:

	â€¢	Use UEFI for both (recommended)

	â€¢	Or Legacy/BIOS for both

	â€¢	You can check with:



[ -d /sys/firmware/efi ] && echo "UEFI mode" || echo "Legacy BIOS mode"



âœ… Final Recap

Step

Action

1

Run backup-linux.sh to save home + packages

2

Wipe & reinstall Windows on main drive

3

Reinstall Linux on second drive

4

Run restore-linux.sh to restore everything

5

Reinstall GRUB if needed







/////////////////



ğŸ§¾ What You Told Me:

	â€¢	Username: matt

	â€¢	Backup drive path: /run/media/linuxdrive-1

	â€¢	Backup archive file: likely home-backup.tar.gz



â¸»



âœ… Updated restore-linux.sh for Your Setup:



#!/bin/bash



# Set your actual user and backup drive path

USER="matt"

BACKUP_DRIVE="/run/media/linuxdrive-1"



# ğŸ“‚ Restore home directory from tar archive

echo "ğŸ“¦ Restoring /home/$USER from tarball..."

tar -xzvf "$BACKUP_DRIVE/home-backup.tar.gz" -C /



# ğŸ”‘ Fix ownership of home directory

echo "ğŸ”§ Fixing permissions..."

chown -R $USER:$USER /home/$USER



# ğŸ“¦ Restore installed pacman packages

echo "ğŸ“¦ Reinstalling pacman packages..."

pacman -Syu --needed - < "$BACKUP_DRIVE/pkglist.txt"



# Optional: restore AUR packages if using yay

if command -v yay &> /dev/null; then

    echo "ğŸ“¦ Reinstalling AUR packages..."

    yay -S --needed - < "$BACKUP_DRIVE/aur-pkglist.txt"

else

    echo "âš ï¸ AUR helper not found. Skipping AUR packages."

fi



echo "âœ… Restore complete!"



â–¶ï¸ How to Run It:

	1.	Save the script:



nano restore-linux.sh



	2.	Paste in the code above (updated with your values)

	3.	Make it executable:



chmod +x restore-linux.sh



4.	Run it:



./restore-linux.sh



ğŸ§  Pro Tip:



Before you run the script, double-check:



ls /run/media/linuxdrive-1/home-backup.tar.gz

ls /run/media/linuxdrive-1/pkglist.txt
